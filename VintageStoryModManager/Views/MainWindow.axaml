<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:VintageStoryModManager.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        x:Class="VintageStoryModManager.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="Vintage Story Mod Manager"
        Width="1100"
        Height="720">
    <Design.DataContext>
        <vm:MainWindowViewModel />
    </Design.DataContext>

    <Grid RowDefinitions="Auto,Auto,*,Auto" Margin="24" RowSpacing="16">
        <StackPanel Orientation="Horizontal" Spacing="12">
            <TextBlock Text="Vintage Story Mod Manager" FontSize="28" FontWeight="SemiBold"/>
            <Border Background="{DynamicResource ThemeAccentBrush}" CornerRadius="12" Padding="10 4" VerticalAlignment="Center">
                <TextBlock Text="Portable" FontSize="14" Foreground="White"/>
            </Border>
        </StackPanel>

        <Grid Grid.Row="1" ColumnDefinitions="Auto,Auto,Auto,Auto,*" ColumnSpacing="16" RowDefinitions="Auto">
            <StackPanel Orientation="Vertical" Grid.Column="0">
                <TextBlock Text="Sort by" FontWeight="SemiBold"/>
                <ComboBox ItemsSource="{Binding SortOptions}" SelectedItem="{Binding SelectedSortOption}" Width="180" />
            </StackPanel>
            <StackPanel Orientation="Vertical" Grid.Column="1">
                <TextBlock Text="Order" FontWeight="SemiBold"/>
                <ToggleSwitch Content="Descending" IsChecked="{Binding SortDescending}" />
            </StackPanel>
            <StackPanel Orientation="Vertical" Grid.Column="2">
                <TextBlock Text="Refresh" FontWeight="SemiBold"/>
                <Button Content="Reload mods" Command="{Binding RefreshCommand}" Width="140" />
            </StackPanel>
            <StackPanel Orientation="Vertical" Grid.Column="3">
                <TextBlock Text="Summary" FontWeight="SemiBold"/>
                <TextBlock Text="{Binding Summary}" FontSize="16" VerticalAlignment="Center"/>
            </StackPanel>
        </Grid>

        <Border Grid.Row="2" CornerRadius="12" Background="#0F000000" Padding="8">
            <DataGrid ItemsSource="{Binding Mods}"
                      AutoGenerateColumns="False"
                      GridLinesVisibility="Horizontal"
                      HeadersVisibility="Column"
                      HorizontalScrollBarVisibility="Auto"
                      VerticalScrollBarVisibility="Auto"
                      RowHeight="60"
                      Sorting="OnModsSorting"
                      SelectionMode="Extended"
                      CanUserReorderColumns="False"
                      IsReadOnly="False">
                <DataGrid.Columns>
                    <DataGridTemplateColumn Header="Icon"
                                            Width="80"
                                            IsReadOnly="True"
                                            Tag="{x:Static vm:SortKey.Name}">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate x:DataType="vm:ModViewModel">
                                <Border Width="48" Height="48" CornerRadius="12" Background="#22007ACC" HorizontalAlignment="Center" VerticalAlignment="Center">
                                    <Grid>
                                        <Image Source="{Binding Icon}" Stretch="UniformToFill" IsVisible="{Binding HasIcon}"/>
                                        <TextBlock Text="{Binding Initials}" FontSize="18" FontWeight="SemiBold" HorizontalAlignment="Center" VerticalAlignment="Center" IsVisible="{Binding HasNoIcon}"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Header="Active"
                                            Width="80"
                                            Tag="{x:Static vm:SortKey.Status}">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate x:DataType="vm:ModViewModel">
                                <ToggleSwitch IsChecked="{Binding IsActive}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Header="Name"
                                            Width="2*"
                                            Tag="{x:Static vm:SortKey.Name}">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate x:DataType="vm:ModViewModel">
                                <TextBlock Text="{Binding DisplayName}" ToolTip.Tip="{Binding Tooltip}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn Header="Version"
                                        Binding="{Binding VersionDisplay}"
                                        Width="*"
                                        Tag="{x:Static vm:SortKey.Version}"/>
                    <DataGridTextColumn Header="Status"
                                        Binding="{Binding StatusText}"
                                        Width="*"
                                        Tag="{x:Static vm:SortKey.Status}"/>
                    <DataGridTextColumn Header="Side"
                                        Binding="{Binding SideDisplay}"
                                        Width="*"
                                        Tag="{x:Static vm:SortKey.Side}"/>
                    <DataGridTextColumn Header="Requirement"
                                        Binding="{Binding RequirementDisplay}"
                                        Width="*"
                                        Tag="{x:Static vm:SortKey.Requirement}"/>
                    <DataGridTextColumn Header="Authors"
                                        Binding="{Binding AuthorsDisplay}"
                                        Width="*"
                                        Tag="{x:Static vm:SortKey.Authors}"/>
                    <DataGridTextColumn Header="Source"
                                        Binding="{Binding SourceHint}"
                                        Width="*"
                                        Tag="{x:Static vm:SortKey.Source}"/>
                    <DataGridTemplateColumn Header="Location"
                                            Width="3*"
                                            Tag="{x:Static vm:SortKey.Location}">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate x:DataType="vm:ModViewModel">
                                <TextBlock Text="{Binding SourcePath}" TextTrimming="CharacterEllipsis" ToolTip.Tip="{Binding SourcePath}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Header="Dependencies"
                                            Width="2*"
                                            Tag="{x:Static vm:SortKey.Dependencies}">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate x:DataType="vm:ModViewModel">
                                <TextBlock Text="{Binding DependenciesDisplay}" TextTrimming="CharacterEllipsis" ToolTip.Tip="{Binding DependenciesDisplay}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Header="Issues"
                                            Width="2*"
                                            Tag="{x:Static vm:SortKey.Issues}">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate x:DataType="vm:ModViewModel">
                                <TextBlock Text="{Binding IssuesDisplay}" TextTrimming="CharacterEllipsis" ToolTip.Tip="{Binding IssuesDisplay}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>

        <Border Grid.Row="3" CornerRadius="8" Background="#0F000000" Padding="12" HorizontalAlignment="Stretch">
            <DockPanel>
                <TextBlock Text="{Binding Summary}" DockPanel.Dock="Left" FontWeight="SemiBold"/>
                <TextBlock Text="{Binding StatusMessage}" HorizontalAlignment="Right"/>
            </DockPanel>
        </Border>
    </Grid>
</Window>
