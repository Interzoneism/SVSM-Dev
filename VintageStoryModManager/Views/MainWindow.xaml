<Window x:Class="VintageStoryModManager.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:VintageStoryModManager.ViewModels"
        xmlns:ui="http://schemas.modernwpf.com/2019"
        mc:Ignorable="d"
        d:DataContext="{d:DesignInstance Type=vm:MainWindowViewModel, IsDesignTimeCreatable=True}"
        Title="Vintage Story Mod Manager"
        Height="720"
        Width="1100"
        ui:WindowHelper.UseModernWindowStyle="True">

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <StackPanel Orientation="Horizontal">
            <TextBlock Text="Vintage Story Mod Manager"
                       FontSize="28"
                       FontWeight="SemiBold" />
            <Border Background="{DynamicResource SystemControlHighlightAccentBrush}"
                    CornerRadius="12"
                    Padding="10,4"
                    Margin="12,6,0,0"
                    VerticalAlignment="Top">
                <TextBlock Text="Portable"
                           FontSize="14"
                           Foreground="White" />
            </Border>
        </StackPanel>

        <Grid Grid.Row="1" Margin="0,16,0,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <StackPanel Orientation="Vertical" Margin="0,0,16,0">
                <TextBlock Text="Sort by" FontWeight="SemiBold" />
                <ComboBox ItemsSource="{Binding SortOptions}"
                          SelectedItem="{Binding SelectedSortOption}"
                          Width="180" />
            </StackPanel>

            <StackPanel Orientation="Vertical" Grid.Column="1" Margin="0,0,16,0">
                <TextBlock Text="Order" FontWeight="SemiBold" />
                <ui:ToggleSwitch OnContent=""
                                  OffContent=""
                                  IsOn="{Binding SortDescending}" />
            </StackPanel>

            <StackPanel Orientation="Vertical" Grid.Column="2" Margin="0,0,16,0">
                <TextBlock Text="Refresh" FontWeight="SemiBold" />
                <Button Content="Reload mods"
                        Command="{Binding RefreshCommand}"
                        Width="140" />
            </StackPanel>
        </Grid>

        <Border Grid.Row="2"
                CornerRadius="12"
                Background="#0F000000"
                Padding="8">
            <ListBox ItemsSource="{Binding Mods}"
                     Background="Transparent"
                     BorderThickness="0"
                     ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                     ScrollViewer.VerticalScrollBarVisibility="Auto"
                     SelectionMode="Single">
                <ListBox.ItemContainerStyle>
                    <Style TargetType="ListBoxItem">
                        <Setter Property="Padding" Value="0" />
                        <Setter Property="Background" Value="Transparent" />
                        <Setter Property="BorderThickness" Value="0" />
                        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                    </Style>
                </ListBox.ItemContainerStyle>
                <ListBox.ItemTemplate>
                    <DataTemplate DataType="{x:Type vm:ModViewModel}">
                        <Border x:Name="CardBackground"
                                Margin="0,2"
                                Padding="10,6"
                                CornerRadius="10"
                                MinHeight="56">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Setter Property="Background" Value="#15000000" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=ListBoxItem}, Path=IsMouseOver}"
                                                     Value="True">
                                            <Setter Property="Background" Value="#22007ACC" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=ListBoxItem}, Path=IsSelected}"
                                                     Value="True">
                                            <Setter Property="Background" Value="#15000000" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <Grid Margin="0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <Border Width="56"
                                        Height="56"
                                        CornerRadius="14"
                                        Background="#22007ACC">
                                    <Grid>
                                        <Image Source="{Binding Icon}"
                                               Stretch="UniformToFill">
                                            <Image.Style>
                                                <Style TargetType="Image">
                                                    <Setter Property="Visibility" Value="Collapsed" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding HasIcon}" Value="True">
                                                            <Setter Property="Visibility" Value="Visible" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Image.Style>
                                        </Image>
                                        <TextBlock Text="{Binding Initials}"
                                                   FontSize="20"
                                                   FontWeight="SemiBold"
                                                   HorizontalAlignment="Center"
                                                   VerticalAlignment="Center">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Visibility" Value="Collapsed" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding HasNoIcon}" Value="True">
                                                            <Setter Property="Visibility" Value="Visible" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </Grid>
                                </Border>

                                <StackPanel Grid.Column="1"
                                            Margin="16,0"
                                            VerticalAlignment="Center">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding DisplayName}"
                                                   FontSize="18"
                                                   FontWeight="SemiBold"
                                                   TextTrimming="CharacterEllipsis"
                                                   ToolTipService.ToolTip="{Binding Tooltip}" />
                                        <Border Background="#D9534F"
                                                CornerRadius="6"
                                                Padding="6,2"
                                                Margin="8,0,0,0">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Visibility" Value="Collapsed" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding HasError}" Value="True">
                                                            <Setter Property="Visibility" Value="Visible" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <TextBlock Text="Issue"
                                                       Foreground="White"
                                                       FontSize="12"
                                                       FontWeight="SemiBold" />
                                        </Border>
                                    </StackPanel>

                                    <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                        <TextBlock TextWrapping="Wrap">
                                            <Run Text="Version: " FontWeight="SemiBold" />
                                            <Run Text="{Binding VersionDisplay}" />
                                        </TextBlock>
                                        <TextBlock Margin="16,0,0,0" TextWrapping="Wrap">
                                            <Run Text="Authors: " FontWeight="SemiBold" />
                                            <Run Text="{Binding AuthorsDisplay}" />
                                        </TextBlock>
                                    </StackPanel>

                                    <TextBlock Text="{Binding Description}"
                                               Margin="0,4,0,0"
                                               TextWrapping="Wrap"
                                               TextTrimming="CharacterEllipsis" />

                                    <StackPanel Orientation="Horizontal"
                                                Margin="0,4,0,0">
                                        <StackPanel.Style>
                                            <Style TargetType="StackPanel">
                                                <Setter Property="Visibility" Value="Collapsed" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=ListBoxItem}, Path=IsSelected}"
                                                                 Value="True">
                                                        <Setter Property="Visibility" Value="Visible" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </StackPanel.Style>
                                        <TextBlock>
                                            <Run Text="Status: " FontWeight="SemiBold" />
                                            <Run Text="{Binding StatusText}" />
                                        </TextBlock>
                                        <TextBlock Margin="16,0,0,0">
                                            <Run Text="Side: " FontWeight="SemiBold" />
                                            <Run Text="{Binding SideDisplay}" />
                                        </TextBlock>
                                        <TextBlock Margin="16,0,0,0">
                                            <Run Text="Requirement: " FontWeight="SemiBold" />
                                            <Run Text="{Binding RequirementDisplay}" />
                                        </TextBlock>
                                        <TextBlock Margin="16,0,0,0">
                                            <Run Text="Dependencies: " FontWeight="SemiBold" />
                                            <Run Text="{Binding DependenciesDisplay}" />
                                        </TextBlock>
                                        <TextBlock Margin="16,0,0,0">
                                            <Run Text="Issues: " FontWeight="SemiBold" />
                                            <Run Text="{Binding IssuesDisplay}" />
                                        </TextBlock>
                                    </StackPanel>

                                    <TextBlock Text="{Binding SourcePath}"
                                               Margin="0,4,0,0"
                                               TextWrapping="Wrap"
                                               TextTrimming="CharacterEllipsis"
                                               Foreground="Gray">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Visibility" Value="Collapsed" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=ListBoxItem}, Path=IsSelected}"
                                                                 Value="True">
                                                        <Setter Property="Visibility" Value="Visible" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                        <TextBlock.ToolTip>
                                            <ToolTip Content="{Binding SourcePath}" />
                                        </TextBlock.ToolTip>
                                    </TextBlock>
                                </StackPanel>

                                <ui:ToggleSwitch Grid.Column="2"
                                                 Width="44"
                                                 HorizontalAlignment="Right"
                                                 VerticalAlignment="Center"
                                                 OnContent=""
                                                 OffContent=""
                                                 IsOn="{Binding IsActive}" />
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </Border>

        <Border Grid.Row="3"
                CornerRadius="8"
                Background="#0F000000"
                Padding="12"
                Margin="0,16,0,0">
            <DockPanel>
                <TextBlock Text="{Binding Summary}"
                           FontWeight="SemiBold"
                           DockPanel.Dock="Left" />
                <TextBlock Text="{Binding StatusMessage}"
                           DockPanel.Dock="Right"
                           TextAlignment="Right" />
            </DockPanel>
        </Border>
    </Grid>
</Window>
