{
  "rules": {
    ".read": false,
    ".write": false,

    "owners": {
      "$playerUid": {
        ".read": "auth != null && (data.val() == auth.uid || root.child('ownershipMigration').child($playerUid).child(auth.uid).val() == true)",
        ".write": "auth != null && ((!data.exists() && newData.val() == auth.uid) || (data.exists() && data.val() == auth.uid && (!newData.exists() || newData.val() == auth.uid)) || (data.exists() && root.child('ownershipMigration').child($playerUid).child(auth.uid).val() == true && newData.val() == auth.uid))"
      }
    },

    "ownershipMigration": {
      "$playerUid": {
        "$newFirebaseUid": {
          ".read": "auth != null && auth.uid == $newFirebaseUid",
          ".write": "auth != null && auth.uid == $newFirebaseUid && (!data.exists() || data.val() == true) && (!newData.exists() || newData.val() == true)"
        }
      }
    },

    "users": {
      "$playerUid": {
        ".read": "auth != null && (root.child('owners').child($playerUid).val() == auth.uid || root.child('ownershipMigration').child($playerUid).child(auth.uid).val() == true)",
        "$slot": {
          ".write": "auth != null && ($slot == 'slot1' || $slot == 'slot2' || $slot == 'slot3' || $slot == 'slot4' || $slot == 'slot5') && (root.child('owners').child($playerUid).val() == auth.uid || root.child('ownershipMigration').child($playerUid).child(auth.uid).val() == true)",
          ".validate": "!newData.exists() || (newData.hasChildren(['content']) && newData.child('content').hasChildren())"
        }
      }
    },

    "registry": {
      ".read": true,
      "$entryId": {
        ".write": "auth != null && (root.child('registryOwners').child($entryId).val() == auth.uid || !data.exists())",
        ".validate": "!newData.exists() || (!newData.child('owner').exists() && (data.exists() || (!data.exists() && newData.child('content').hasChild('uploaderId') && (root.child('owners').child(newData.child('content').child('uploaderId').val()).val() == auth.uid || root.child('ownershipMigration').child(newData.child('content').child('uploaderId').val()).child(auth.uid).val() == true))))"
      }
    },

    "registryOwners": {
      "$entryId": {
        ".read": false,
        ".write": "auth != null && ((!data.exists() && newData.val() == auth.uid) || (data.exists() && data.val() == auth.uid))"
      }
    },

    "compatVotes": {
      "$modKey": {
        "$versionKey": {
          "users": {
            ".read": true,
            "$userId": {
              ".write": "auth != null && auth.uid == $userId",
              ".validate": "!newData.exists() || (newData.hasChildren(['option','vintageStoryVersion','updatedUtc']) && newData.child('option').isString() && (newData.child('option').val() == 'fullyFunctional' || newData.child('option').val() == 'noIssuesSoFar' || newData.child('option').val() == 'someIssuesButWorks' || newData.child('option').val() == 'notFunctional' || newData.child('option').val() == 'crashesOrFreezesGame' || newData.child('option').val() == 'workingPerfectly' || newData.child('option').val() == 'notWorking') && newData.child('vintageStoryVersion').isString() && newData.child('updatedUtc').isString() && (!newData.child('comment').exists() || newData.child('comment').isString()) && (!((newData.child('option').val() == 'notFunctional') || (newData.child('option').val() == 'notWorking') || (newData.child('option').val() == 'crashesOrFreezesGame')) || (newData.child('comment').isString() && newData.child('comment').val().matches(/\\S/))))"
            }
          }
        }
      }
    },

    "adminRegistry": {
      "$firebaseUid": {
        ".read": "auth != null && auth.uid == $firebaseUid",
        ".write": "auth != null && auth.uid == $firebaseUid"
      }
    }
  }
}
