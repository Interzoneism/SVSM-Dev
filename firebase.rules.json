{
  "rules": {
    ".read": false,
    ".write": false,

    "owners": {
      "$playerUid": {
        ".read": "auth != null && data.val() == auth.uid",
        ".write": "auth != null && ((!data.exists() && newData.val() == auth.uid) || (data.exists() && data.val() == auth.uid && (!newData.exists() || newData.val() == auth.uid)))"
      }
    },

    "users": {
      "$playerUid": {
        ".read": "auth != null && root.child('owners').child($playerUid).val() == auth.uid",
        "$slot": {
          ".write": "auth != null && ($slot == 'slot1' || $slot == 'slot2' || $slot == 'slot3' || $slot == 'slot4' || $slot == 'slot5') && root.child('owners').child($playerUid).val() == auth.uid",
          ".validate": "!newData.exists() || (newData.hasChildren(['content']) && newData.child('content').hasChildren())"
        }
      }
    },

    "registry": {
      ".read": true,
      "$entryId": {
        ".write": "auth != null && (root.child('registryOwners').child($entryId).val() == auth.uid || !data.exists())",
        ".validate": "!newData.exists() || (!newData.child('owner').exists() && (data.exists() || (!data.exists() && newData.child('content').hasChild('uploaderId') && root.child('owners').child(newData.child('content').child('uploaderId').val()).val() == auth.uid)))"
      }
    },

    "registryOwners": {
      "$entryId": {
        ".read": false,
        ".write": "auth != null && ((!data.exists() && newData.val() == auth.uid) || (data.exists() && data.val() == auth.uid))"
      }
    },

    "compatVotes": {
      "$modKey": {
        "$versionKey": {
          "users": {
            ".read": true,
            "$userId": {
              ".write": "auth != null && auth.uid == $userId",
              ".validate": "!newData.exists() || (newData.hasChildren(['option','vintageStoryVersion','updatedUtc']) && newData.child('option').isString() && (newData.child('option').val() == 'fullyFunctional' || newData.child('option').val() == 'noIssuesSoFar' || newData.child('option').val() == 'someIssuesButWorks' || newData.child('option').val() == 'notFunctional' || newData.child('option').val() == 'crashesOrFreezesGame' || newData.child('option').val() == 'workingPerfectly' || newData.child('option').val() == 'notWorking') && newData.child('vintageStoryVersion').isString() && newData.child('updatedUtc').isString() && (!newData.child('comment').exists() || newData.child('comment').isString()) && (!((newData.child('option').val() == 'notFunctional') || (newData.child('option').val() == 'notWorking') || (newData.child('option').val() == 'crashesOrFreezesGame')) || (newData.child('comment').isString() && newData.child('comment').val().matches(/\\S/))))"
            }
          },
          "summary": {
            ".read": true,
            ".write": "auth != null",
            ".validate": "!newData.exists() || (newData.hasChildren(['fullyFunctional','noIssuesSoFar','someIssuesButWorks','notFunctional','crashesOrFreezesGame','recentComments']) && newData.child('fullyFunctional').isNumber() && newData.child('fullyFunctional').val() >= 0 && newData.child('noIssuesSoFar').isNumber() && newData.child('noIssuesSoFar').val() >= 0 && newData.child('someIssuesButWorks').isNumber() && newData.child('someIssuesButWorks').val() >= 0 && newData.child('notFunctional').isNumber() && newData.child('notFunctional').val() >= 0 && newData.child('crashesOrFreezesGame').isNumber() && newData.child('crashesOrFreezesGame').val() >= 0 && (!newData.child('userVoteId').exists() || newData.child('userVoteId').isString()) && (!newData.child('updatedUtc').exists() || newData.child('updatedUtc').isString()) && (!newData.child('recentComments').exists() || newData.child('recentComments').hasChildren(['notFunctional','crashesOrFreezesGame'])))",
            "recentComments": {
              ".validate": "!newData.exists() || (newData.child('notFunctional').isList() && newData.child('crashesOrFreezesGame').isList())",
              "notFunctional": {
                "$idx": {
                  ".validate": "!newData.exists() || (newData.hasChildren(['text','userId']) && newData.child('text').isString() && newData.child('text').val().matches(/\\S/) && newData.child('userId').isString() && (!newData.child('updatedUtc').exists() || newData.child('updatedUtc').isString()))"
                }
              },
              "crashesOrFreezesGame": {
                "$idx": {
                  ".validate": "!newData.exists() || (newData.hasChildren(['text','userId']) && newData.child('text').isString() && newData.child('text').val().matches(/\\S/) && newData.child('userId').isString() && (!newData.child('updatedUtc').exists() || newData.child('updatedUtc').isString()))"
                }
              }
            }
          }
        }
      }
    }
  }
}
